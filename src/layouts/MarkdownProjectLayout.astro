---
import { Image } from "astro:assets";
import BaseLayout from "./BaseLayout.astro";
import { Project } from "../models/Project";

const raw = (Astro.props as any).frontmatter ?? Astro.props;
const project = new Project(raw);

const formattedDate = project.formattedDate;
const cover = project.imageUrl;
const coverAlt = project.imageAlt;
const contributors = project.contributors;
const skills = project.skills;
const links = project.links;
---


<BaseLayout pageTitle={project.title}>
    <article class="post-card">
        {cover ? (
            <figure class="post-cover">
                <img src={cover} alt={coverAlt} />
            </figure>
        ) : null}

        <header class="post-hero">
            <h1>{project.title}</h1>
            <div class="meta">
                <span class="meta-author">Par {contributors.join(', ')}</span>
                <time class="meta-date">{formattedDate}</time>
            </div>
            {project.description ? <p class="excerpt">{project.description}</p> : null}

            {skills.length ? (
                <h2>Compétences :</h2>
                <div class="skills" aria-hidden="true">
                    {
                            skills.map((skill: string | null | undefined) => {
                                if (!skill) return null;
                                const icon = `/icons/${String(skill).toLowerCase()}.svg`;
                                return <img class="skill" src={icon} alt={skill} width="24" height="24" />;
                            })
                        }
                </div>
            ) : null}

            {links.length ? (
                <h2>Liens :</h2>
                <div class="links" aria-hidden="true">
                    {
                        links.map((link: { url?: string | URL | null | undefined; label?: string | null | undefined }) => {
                            const label = String(link.label ?? 'lien');
                            return <div class="link">
                                <Image src={`/icons/${label.toLowerCase()}.svg`} inferSize={true} alt={label} width={24} height={24} title={label} />
                                <a href={link.url} target="_blank" rel="noopener noreferrer">{link.url}</a>
                            </div>;
                        })
                    }
                </div>
            ) : null}
        </header>

        <section class="post-content">
            <slot />
        </section>

        <footer class="post-footer">
            <a href="/projects/">Retour à la liste des projets</a>
        </footer>
    </article>
</BaseLayout>

<style>
    .skills {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }

    .skill {
        display: block;
    }

    .links {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1rem;
    }

    .link {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .link a {
        word-break: break-all;
    }

    .link img {
        flex-shrink: 0;
    }

    .meta-date {
        font-size: 0.9rem;
        margin-left: 1rem;
    }
</style>
