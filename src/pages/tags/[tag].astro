---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ArticleList from "../../components/article/ArticleList.astro";

export async function getStaticPaths() {
    // Collect all articles and extract unique tags to generate a page for each tag
    const allPosts = Object.values(import.meta.glob('../articles/*.md', { eager: true }));
    const tags = new Set<string>();
    allPosts.forEach((post: any) => {
        (post.frontmatter.tags || []).forEach((t: string) => tags.add(t));
    });

    return Array.from(tags).map((tag) => ({ params: { tag } }));
}

const { tag } = Astro.params;
const allPosts = Object.values(import.meta.glob('../articles/*.md', { eager: true }));
const filteredPosts = allPosts.filter((post: any) => post.frontmatter.tags?.includes(tag));
---

<BaseLayout pageTitle={`Tag: ${tag}`}>
    <section class="page-section">
        <h1>Tag : {tag}</h1>
        <p>Articles étiquetés avec « {tag} »</p>

        {filteredPosts.length > 0 ? (
            <ArticleList allPosts={filteredPosts} />
        ) : (
            <p>Aucun article trouvé pour ce tag.</p>
        )}
    </section>
</BaseLayout>